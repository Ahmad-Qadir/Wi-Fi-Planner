<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wi-Fi LinkPlanner - RSSI Summary</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { padding: 2rem; }
  .rssi-result { font-size: 1.4rem; font-weight: bold; }
  .legend span { display: inline-block; width: 30px; text-align: center; margin-right: 5px; }
</style>
</head>
<body>
<div class="container">
  <h1 class="mb-2">Wi-Fi LinkPlanner - RSSI Summary</h1>
  <p class="text-muted">Dynamic calculation of RSSI with wall/floor summary.</p>

  <form id="rssiForm">
    <div class="mb-3">
      <label class="form-label">AP Transmit Power (dBm)</label>
      <input type="range" class="form-range" min="5" max="30" value="20" id="PtxRange">
      <span id="PtxValue">20 dBm</span>
    </div>

    <div class="mb-3">
      <label class="form-label">Frequency (MHz)</label>
      <select class="form-select" id="freqSelect">
        <option value="2400" selected>2.4 GHz</option>
        <option value="5000">5 GHz</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Distance to Client (meters)</label>
      <input type="number" class="form-control" id="distance" value="2" step="0.1" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Walls / Floors</label>
      <div id="wallsContainer"></div>
      <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="addWallBtn">Add Wall/Floor</button>
    </div>
  </form>

  <hr>
  <div id="results" class="mt-4"></div>

  <div class="mt-3 legend">
    <h6>Legend:</h6>
    <span style="color:green;">●</span> Good (> -65 dBm) &nbsp;
    <span style="color:orange;">●</span> Medium (-75 to -65 dBm) &nbsp;
    <span style="color:red;">●</span> Weak (<= -75 dBm)
  </div>
</div>

<script>
const PtxRange = document.getElementById('PtxRange');
const PtxValue = document.getElementById('PtxValue');
const freqSelect = document.getElementById('freqSelect');
const distanceInput = document.getElementById('distance');
const wallsContainer = document.getElementById('wallsContainer');
const addWallBtn = document.getElementById('addWallBtn');
const resultsDiv = document.getElementById('results');

function calculateRSSI(Ptx, freq, distance, totalWallLoss) {
    const d_km = distance / 1000;
    const fspl = 20*Math.log10(d_km) + 20*Math.log10(freq) + 32.44;
    return Ptx - fspl - totalWallLoss;
}

function addWallInput(value = 0) {
    const div = document.createElement('div');
    div.className = 'd-flex gap-2 mb-1';
    div.innerHTML = `
      <select class="form-select wall-type">
        <option value="15" ${value==15 ? 'selected' : ''}>Concrete (15 dB)</option>
        <option value="5" ${value==5 ? 'selected' : ''}>Plastic (5 dB)</option>
        <option value="7" ${value==7 ? 'selected' : ''}>Glass (7 dB)</option>
      </select>
      <button type="button" class="btn btn-danger btn-sm removeWallBtn">Remove</button>
    `;
    wallsContainer.appendChild(div);

    div.querySelector('.removeWallBtn').addEventListener('click', () => {
        wallsContainer.removeChild(div);
        updateRSSI();
    });

    div.querySelector('.wall-type').addEventListener('change', updateRSSI);
}

addWallInput(); // initial wall
addWallBtn.addEventListener('click', () => addWallInput());

PtxValue.textContent = PtxRange.value + " dBm";
PtxRange.addEventListener('input', ()=> {
    PtxValue.textContent = PtxRange.value + " dBm";
    updateRSSI();
});
freqSelect.addEventListener('change', updateRSSI);
distanceInput.addEventListener('input', updateRSSI);

function updateRSSI(){
    const Ptx = parseFloat(PtxRange.value);
    const freq = parseFloat(freqSelect.value);
    const distance = parseFloat(distanceInput.value);

    const wallTypes = Array.from(document.querySelectorAll('.wall-type')).map(sel => parseFloat(sel.value));
    const totalWallLoss = wallTypes.reduce((a,b) => a+b, 0);

    const rssi = calculateRSSI(Ptx, freq, distance, totalWallLoss);

    let color = '';
    if(rssi > -65) color = 'green';
    else if(rssi > -75) color = 'orange';
    else color = 'red';

    resultsDiv.innerHTML = `
      <div class="alert alert-info">
        <p>Total Walls/Floors: <strong>${wallTypes.length}</strong></p>
        <p>Total Wall/Floor Loss: <strong>${totalWallLoss} dB</strong></p>
        <p class="rssi-result">Received Signal (Rx, RSSI): <strong style="color:${color}">${rssi.toFixed(2)} dBm</strong></p>
      </div>
    `;
}

// Initial calculation
updateRSSI();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
